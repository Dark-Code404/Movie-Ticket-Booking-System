{% extends "base.html" %}
{% block title %}Home{% endblock title %}

{% block content %}
<div class="container mt-5">
    <!-- Search Bar -->
    <div class="row mb-5">
        <div class="col-md-8 offset-md-2">
            <form method="GET" action="{% url 'home' %}" class="d-flex">
                <input 
                    type="text" 
                    name="search" 
                    class="form-control me-2" 
                    placeholder="Search for a movie..." 
                    value="{{ request.GET.search }}"
                >
                <button class="btn btn-primary" type="submit">Search</button>
            </form>
        </div>
    </div>

    <!-- Now Showing Section -->
    <section class="mb-5">
        <h4 class="mb-4 text-uppercase font-weight-bold">Now Showing</h4>
        <div class="row row-cols-1 row-cols-md-3 g-4">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <strong class="text-danger">{{ message }}</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
            
            {% if now_showing_movies %}
                {% for movie in now_showing_movies %}
                    <div class="col">
                        <div class="card border-0 rounded-3 shadow-lg">
                            <img src="{{ movie.poster.url }}" class="card-img-top" alt="Movie Poster" style="object-fit: cover; height: 250px;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-3 text-dark">{{ movie.name }}</h5>
                                <p class="card-text mb-4 text-muted">{{ movie.description|truncatewords:15 }}</p>
                                <a href="{% url 'showtime' movie.mid %}" class="btn btn-primary mt-auto">Book Showtimes</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>No movies found for your search.</p>
            {% endif %}
        </div>
    </section>

    <!-- Upcoming Section -->
    <section>
        <h4 class="mb-4 text-uppercase font-weight-bold">Upcoming</h4>
        <div class="row row-cols-1 row-cols-md-3 g-4">
            {% if upcoming_movies %}
                {% for movie in upcoming_movies %}
                    <div class="col">
                        <div class="card border-0 rounded-3 shadow-lg">
                            <img src="{{ movie.poster.url }}" class="card-img-top" alt="Movie Poster" style="object-fit: cover; height: 250px;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-3 text-dark">{{ movie.name }}</h5>
                                <p class="card-text mb-4 text-muted">{{ movie.description|truncatewords:15 }}</p>
                                <a href="{% url 'showtime' movie.mid %}" class="btn btn-outline-primary mt-auto">View Details</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>No upcoming movies found for your search.</p>
            {% endif %}
        </div>
    </section>
</div>
{% endblock content %}
